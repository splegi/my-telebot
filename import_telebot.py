import telebot
from telebot import types
import random
import schedule
import time
import threading
from datetime import datetime
from prometheus_client import start_http_server, Counter

bot = telebot.TeleBot('8020636906:AAG0SPFAfhvQ4Tj1ZpOYzdLhogyraAI-UXU')
# –ú–µ—Ç—Ä–∏–∫–∞: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤
compliments_sent = Counter('compliments_sent_total', 'Total compliments sent')

# –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞ Prometheus –Ω–∞ –ø–æ—Ä—Ç—É 8000
start_http_server(8000)
# –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤
compliments = [
    "—É —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ –∫—Ä–∞—Å–∏–≤—ã–µ –≥–ª–∞–∑–∫–∏, —Ç–∞–∫–∏–µ –∫—É–∫–æ–ª—å–Ω—ã–µ –∑–µ–ª–µ–Ω—ã–µ!",
    "—É —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–∞—è —É–ª—ã–±–∫–∞!!!!",
    "—É —Ç–µ–±—è –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π –Ω–æ—Å–∏–∫, –∞–∫–∫—É—Ä–∞—Ç–Ω–µ–Ω—å–∫–∏–π —Ç–∞–∫–æ–π!",
    "—É —Ç–µ–±—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ –º–∞–ª–µ–Ω—å–∫–∏–µ —â–µ—á–∫–∏!",
    "—É —Ç–µ–±—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ –≤–æ–ª–æ—Å–∏–∫–∏, —Å–ª–æ–≤–Ω–æ —à–µ—Ä—Å—Ç–∫–∞ –∫–æ—Ç–∏–∫–∞!!",
    "—É —Ç–µ–±—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π –ø–æ–¥–±–æ—Ä–æ–¥–æ—á–µ–∫!",
    "—É —Ç–µ–±—è –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ –±—Ä–æ–≤–∫–∏ –∏ —Ä–µ—Å–Ω–∏—á–∫–∏!",
    "—É —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ –∫—Ä–∞—Å–∏–≤–∞—è –∏ –º–∏–ª–∞—è —Ñ–æ—Ä–º–∞ –ª–∏—Ü–∞!",
    "—É–ª—ã–±–Ω–∏—Å—å!!!",
    "–∞ —è —Ç–µ–±—è –æ—á–µ–Ω—å —Å–∏–ª—å–Ω–æ –ª—é–±–ª—é!!!",
    "—É —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ –∫—Ä–∞—Å–∏–≤–∞—è —Ç–æ–Ω–µ–Ω—å–∫–∞—è, —Ö—Ä—É–ø–∫–∞—è —à–µ—è!",
    "—É —Ç–µ–±—è —Ç–∞–∫–∏–µ –º–∞–ª–µ–Ω—å–∫–∏–µ —É–∑–∫–∏–µ –ø–ª–µ—á–∏–∫–∏, –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ!!!",
    "—É —Ç–µ–±—è –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è —Å–ø–∏–Ω–∫–∞, —Ö–æ—á—É –µ–µ –º—è—Ç—å –º–Ω–æ–≥–æ!",
    "—É —Ç–µ–±—è –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –º–∏–ª—ã–µ –∏ –∫—Ä–∞—Å–∏–≤—ã–µ –ª–∞–ø–∫–∏, –æ–Ω–∏ —Ç–∞–∫–∏–µ –º–∞–ª–µ–Ω—å–∫–∏–µ –∏ —Ç–æ–Ω–µ–Ω—å–∫–∏–µ –Ω—è–Ω—è–Ω—è!",
    "—É —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–∞—è –≥—Ä—É–¥—å! –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞, —Ñ–æ—Ä–º—ã –∏ –≤–∫—É—Å–∞!",
    "—É —Ç–µ–±—è –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω—ã–π —Å—Ç—Ä–æ–π–Ω–µ–Ω—å–∫–∏–π –∂–∏–≤–æ—Ç–∏–∫! –æ–Ω –±–µ–∑—É–º–Ω–æ –≤–∫—É—Å–Ω—ã–π –∏ –∫—Ä–∞—Å–∏–≤—ã–π.. —Ö–æ—á—É –º–Ω–æ–≥–æ —Ü–µ–ª–æ–≤–∞—Ç—å –µ–≥–æ!",
    "—É —Ç–µ–±—è –æ—á–µ–Ω—å –æ—á–µ–Ω—å –∫—Ä–∞—Å–∏–≤–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞–ª–∏—è!!!! —è —Ç–∞–∫ –ª—é–±–ª—é –µ–µ –º—è—Ç—å –∏ —Å–º—É—â–∞—Ç—å —Ç–µ–±—è —ç—Ç–∏–º –º—É—Ä!",
    "—É —Ç–µ–±—è —Ç–∞–∫–∏–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ –∏ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –±–µ–¥—Ä–∞! –ü–µ—Ä–µ—Ö–æ–¥ –∏ –∏–∑–≥–∏–± –æ—Ç –Ω–∏—Ö –∫ –∂–∏–≤–æ—Ç–∏–∫—É –ø—Ä–æ—Å—Ç–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª–µ–Ω!",
    "—Ç–≤–æ—è –ø–æ–ø–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–∞! —Ç–∞–∫–∞—è –∏–¥–µ–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞, —Ä–∞–∑–º–µ—Ä, –æ–±–æ–∂–∞—é!!!",
    "—É —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ –≤–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω—ã–µ –¥—ã—Ä–æ—á–∫–∏, —è —Ç–∞–∫ –ª—é–±–ª—é –∏—Ö —Ü–µ–ª–æ–≤–∞—Ç—å, –ª–∏–∑–∞—Ç—å –∏ —Ç—Ä–∞—Ö–∞—Ç—å –º—É—Ä! –≤ –Ω–∏—Ö —Ç–∞–∫ —Ç–µ–ø–ª–æ –∏ —Ö–æ—Ä–æ—à–æ..",
    "—è —Ç–∞–∫ –ª—é–±–ª—é —Ç–≤–æ–∏ –º–∞–ª–µ–Ω—å–∫–∏–µ –∫—Ä–∞—Å–∏–≤—ã–µ –Ω–æ–∂–∫–∏!! –æ–Ω–∏ –ø–∏–∑–¥–µ—Ü –∫–∞–∫–∏–µ –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ, —Ö–æ—á—É –∏—Ö —Ä–∞—Å—Ü–µ–ª–æ–≤–∞—Ç—å, –ø–æ–∫—É—Å–∞—Ç—å –∏ –æ–±–ª–∏–∑–∞—Ç—å..",
    "—Ç–≤–æ–∏ —Å—Ç–æ–ø—ã –ø—Ä–µ–∫—Ä–∞—Å–Ω—ã–µ, —Ç–∞–∫–∏–µ –º–∞–ª–µ–Ω—å–∫–∏–µ —É —Ç–µ–±—è –Ω–æ–∂–∫–∏!",
    "—É —Ç–µ–±—è —Ç–∞–∫–∞—è –ø—Ä–µ–∫—Ä–∞—Å–Ω–∞—è —Ñ–∏–≥—É—Ä–∞!",
    "—Ç—ã –æ—á–µ–Ω—å –≤–∫—É—Å–Ω–∞—è –¥–µ–≤–æ—á–∫–∞!",
    "–º–æ–π —Å–ª–∞–¥–∫–∏–π –∫–æ—Ç–µ–Ω–æ–∫!",
    "–º–æ—è –º–∞–ª–µ–Ω—å–∫–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞!!!",
    "—É–ª—ã–±–Ω–∏—Å—å!!!!!"
]

# –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è chat_id
chat_id = None

def send_message_hour():
    global chat_id
    if chat_id is not None:
        current_hour = datetime.now().hour
        if 7 <= current_hour < 23:
            compliment = random.choice(compliments)
            bot.send_message(chat_id, compliment)
            compliments_sent.inc()

# –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
schedule.every().hour.do(send_message_hour)

def schedule_checker():
    while True:
        schedule.run_pending()
        time.sleep(1)

@bot.message_handler(commands=['start'])
def main(message):
    global chat_id
    chat_id = message.chat.id

    markup = types.InlineKeyboardMarkup()
    markup.add(types.InlineKeyboardButton("–ª—é–±–∏—à—å –º–µ–Ω—è??", callback_data="love"))
    markup.add(types.InlineKeyboardButton("–•–æ—á–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –∫–æ—Ç–∏–∫–æ–≤?", url='https://ya.ru/images/search?text=–º–∏–ª—ã–µ%20–∫–æ—Ç—è—Ç–∞'))
    markup.add(types.InlineKeyboardButton("–£ —Ç–µ–±—è –ø–ª–æ—Ö–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ? –ü–æ—Å–º–æ—Ç—Ä–∏ –Ω–∞ —Ç—é–ª–µ–Ω—á–∏–∫–æ–≤!", url='https://yandex.ru/images/search?from=tabbar&img_url=https%3A%2F%2Fpushinka.top%2Fuploads%2Fposts%2F2023-08%2F1693322844_pushinka-top-p-morskoi-kotik-kartinki-instagram-29.jpg&lr=21776&pos=9&rpt=simage&text=—Ç—é–ª–µ–Ω—á–∏–∫'))
    markup.add(types.InlineKeyboardButton("–•–æ—á–µ—à—å –ø–æ–ª—É—á–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç–æ–≤??", callback_data="comp"))
    bot.reply_to(message, '–ü—Ä–∏–≤–µ—Ç –º–æ—è –ª—é–±–∏–º–∞—è –¥–µ–≤–æ—á–∫–∞! –≠—Ç–æ –ø–æ–¥–∞—Ä–æ–∫ —Ç–µ–±–µ –Ω–∞ –≥–æ–¥–∏–∫! –ë–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ–±–µ —Å–ª—É—á–∞–π–Ω—ã–µ, –Ω–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –ª–∏—á–Ω–æ –º–Ω–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã!üíóüíóüíó', reply_markup=markup)

@bot.callback_query_handler(func=lambda callback: True)
def callback_message(callback):
    if callback.data == "love":
        bot.send_message(callback.message.chat.id, "–ê —è –æ—á–µ–Ω—å –æ—á–µ–Ω—å –ª—é–±–ª—é —Ç–µ–±—è —Å–æ–Ω–µ—á–∫–∞!")
    elif callback.data == "comp":
        random_compliments = random.choice(compliments)
        bot.send_message(callback.message.chat.id, random_compliments)
        compliments_sent.inc()

# –ó–∞–ø—É—Å–∫ –ø–æ—Ç–æ–∫–∞ –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
threading.Thread(target=schedule_checker).start()

# –ü–æ–ª–ª–∏–Ω–≥ –¥–ª—è –±–æ—Ç–∞
bot.polling(none_stop=True)
